<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>eTender System</title>
  <!-- Bootstrap CSS (CDN for enterprise-grade styling) -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      padding-top: 70px;
    }
    .nav-link {
      font-size: 1.1rem;
      font-weight: 500;
    }
    .content-section {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
    <a class="navbar-brand" href="#">eTender System</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#create">Create</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#publish">Publish</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#monitor">Monitor</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#compare">Compare Quote</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#bid">Bid</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#finalize">Finalize</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Page Content -->
  <div class="container">
    <!-- Create Section -->
    <section id="create" class="content-section">
      <h2>Create Tender</h2>
      <p>Fill out the tender details to create a new tender event.</p>
      <!-- For simplicity, we show a form similar to the current event input -->
      <form id="createTenderForm">
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="event_id">Tender ID</label>
            <input type="text" class="form-control" id="event_id" placeholder="e.g., TND-2025-003" required>
          </div>
          <div class="form-group col-md-6">
            <label for="commodity">Commodity</label>
            <input type="text" class="form-control" id="commodity" placeholder="e.g., IT_INFRASTRUCTURE" required>
          </div>
        </div>
        <div class="form-group">
          <label for="item">Item</label>
          <input type="text" class="form-control" id="item" placeholder="e.g., Server" required>
        </div>
        <div class="form-row">
          <div class="form-group col-md-4">
            <label for="line_item">Line Item</label>
            <input type="text" class="form-control" id="line_item" placeholder="e.g., Dell PowerEdge R740" required>
          </div>
          <div class="form-group col-md-4">
            <label for="line_number">Line Number</label>
            <input type="number" class="form-control" id="line_number" placeholder="1" required>
          </div>
          <div class="form-group col-md-4">
            <label for="supplier_id">Supplier ID</label>
            <input type="text" class="form-control" id="supplier_id" placeholder="e.g., SUPP-DELL-001" required>
          </div>
        </div>
        <div class="form-group">
          <label for="supplier_name">Supplier Name</label>
          <input type="text" class="form-control" id="supplier_name" placeholder="e.g., Dell Technologies" required>
        </div>
        <div class="form-row">
          <div class="form-group col-md-4">
            <label for="bid_amount">Bid Amount</label>
            <input type="number" class="form-control" id="bid_amount" placeholder="e.g., 150000.00" required>
          </div>
          <div class="form-group col-md-4">
            <label for="bid_status">Bid Status</label>
            <input type="text" class="form-control" id="bid_status" placeholder="PENDING" required>
          </div>
          <div class="form-group col-md-4">
            <label for="evaluation_score">Evaluation Score</label>
            <input type="number" step="0.1" class="form-control" id="evaluation_score" placeholder="e.g., 85.5" required>
          </div>
        </div>
        <div class="form-group">
          <label for="submission_timestamp">Submission Timestamp</label>
          <input type="datetime-local" class="form-control" id="submission_timestamp" required>
        </div>
        <button type="submit" class="btn btn-primary">Create Tender</button>
      </form>
    </section>

    <!-- Publish Section -->
    <section id="publish" class="content-section">
      <h2>Publish Tender</h2>
      <p>Review and publish the tender to invite bids.</p>
      <!-- This section could list the created tenders and offer a publish button. -->
      <p>[Functionality to review and publish tenders goes here.]</p>
    </section>

    <!-- Monitor Section -->
    <section id="monitor" class="content-section">
      <h2>Monitor Tenders</h2>
      <p>View all historical tender events and bid details.</p>
      <table class="table table-bordered" id="historicalTable">
        <thead class="thead-dark">
          <tr>
            <th>Tender ID</th>
            <th>Commodity</th>
            <th>Item</th>
            <th>Supplier Name</th>
            <th>Bid Amount</th>
            <th>Bid Status</th>
            <th>Submission Timestamp</th>
            <th>Evaluation Score</th>
          </tr>
        </thead>
        <tbody>
          <!-- Historical data will be populated here via JavaScript -->
        </tbody>
      </table>
    </section>

    <!-- Compare Quote Section -->
    <section id="compare" class="content-section">
      <h2>Compare Quote</h2>
      <p>Compare the current tender with historical data for insights and recommendations.</p>
      <form id="compareForm">
        <!-- For simplicity, reuse the same form fields as in Create -->
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="cmp_event_id">Tender ID</label>
            <input type="text" class="form-control" id="cmp_event_id" placeholder="e.g., TND-2025-003" required>
          </div>
          <div class="form-group col-md-6">
            <label for="cmp_commodity">Commodity</label>
            <input type="text" class="form-control" id="cmp_commodity" placeholder="e.g., IT_INFRASTRUCTURE" required>
          </div>
        </div>
        <div class="form-group">
          <label for="cmp_item">Item</label>
          <input type="text" class="form-control" id="cmp_item" placeholder="e.g., Server" required>
        </div>
        <div class="form-row">
          <div class="form-group col-md-4">
            <label for="cmp_line_item">Line Item</label>
            <input type="text" class="form-control" id="cmp_line_item" placeholder="e.g., Dell PowerEdge R740" required>
          </div>
          <div class="form-group col-md-4">
            <label for="cmp_line_number">Line Number</label>
            <input type="number" class="form-control" id="cmp_line_number" placeholder="1" required>
          </div>
          <div class="form-group col-md-4">
            <label for="cmp_supplier_id">Supplier ID</label>
            <input type="text" class="form-control" id="cmp_supplier_id" placeholder="e.g., SUPP-DELL-001" required>
          </div>
        </div>
        <div class="form-group">
          <label for="cmp_supplier_name">Supplier Name</label>
          <input type="text" class="form-control" id="cmp_supplier_name" placeholder="e.g., Dell Technologies" required>
        </div>
        <div class="form-row">
          <div class="form-group col-md-4">
            <label for="cmp_bid_amount">Bid Amount</label>
            <input type="number" class="form-control" id="cmp_bid_amount" placeholder="e.g., 150000.00" required>
          </div>
          <div class="form-group col-md-4">
            <label for="cmp_bid_status">Bid Status</label>
            <input type="text" class="form-control" id="cmp_bid_status" placeholder="PENDING" required>
          </div>
          <div class="form-group col-md-4">
            <label for="cmp_evaluation_score">Evaluation Score</label>
            <input type="number" step="0.1" class="form-control" id="cmp_evaluation_score" placeholder="e.g., 85.5" required>
          </div>
        </div>
        <div class="form-group">
          <label for="cmp_submission_timestamp">Submission Timestamp</label>
          <input type="datetime-local" class="form-control" id="cmp_submission_timestamp" required>
        </div>
        <button type="submit" class="btn btn-info">Compare Quote & Get Insights</button>
      </form>
      <br>
      <div id="insightsResult" class="alert alert-secondary" style="display: none;"></div>
    </section>

    <!-- Bid Section -->
    <section id="bid" class="content-section">
      <h2>Bid</h2>
      <p>Place your bid based on the insights and comparison.</p>
      <p>[Bid placement functionality goes here.]</p>
    </section>

    <!-- Finalize Section -->
    <section id="finalize" class="content-section">
      <h2>Finalize</h2>
      <p>Finalize the tender process and award the contract.</p>
      <p>[Finalization functionality goes here.]</p>
    </section>
  </div>

  <!-- jQuery and Bootstrap JS (CDN) -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Load historical data and populate the Monitor table.
    async function loadHistoricalData() {
      try {
        const response = await fetch('/api/historical');
        const data = await response.json();
        const tbody = document.querySelector("#historicalTable tbody");
        tbody.innerHTML = "";
        data.forEach(event => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${event.event_id}</td>
            <td>${event.commodity}</td>
            <td>${event.item}</td>
            <td>${event.supplier_name}</td>
            <td>${event.bid_amount}</td>
            <td>${event.bid_status}</td>
            <td>${event.submission_timestamp}</td>
            <td>${event.evaluation_score}</td>
          `;
          tbody.appendChild(row);
        });
      } catch (error) {
        console.error("Error loading historical data:", error);
      }
    }
    
    // Handle the Compare Quote form submission.
    document.getElementById("compareForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const currentEvent = {
        event_id: document.getElementById("cmp_event_id").value,
        commodity: document.getElementById("cmp_commodity").value,
        item: document.getElementById("cmp_item").value,
        line_item: document.getElementById("cmp_line_item").value,
        line_number: document.getElementById("cmp_line_number").value,
        supplier_id: document.getElementById("cmp_supplier_id").value,
        supplier_name: document.getElementById("cmp_supplier_name").value,
        bid_amount: document.getElementById("cmp_bid_amount").value,
        bid_status: document.getElementById("cmp_bid_status").value,
        evaluation_score: document.getElementById("cmp_evaluation_score").value,
        submission_timestamp: document.getElementById("cmp_submission_timestamp").value
      };
      
      try {
        const response = await fetch("/api/ai_insights", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ current_event: currentEvent })
        });
        const result = await response.json();
        const insightsDiv = document.getElementById("insightsResult");
        insightsDiv.style.display = "block";
        insightsDiv.innerHTML = "<strong>AI Insights:</strong><br>" + result.ai_insights;
        console.log("GPT Prompt (for debugging):", result.gpt_prompt);
      } catch (error) {
        console.error("Error getting AI insights:", error);
      }
    });
    
    // Call the function to load historical data when the page loads.
    document.addEventListener("DOMContentLoaded", loadHistoricalData);
  </script>
</body>
</html>
